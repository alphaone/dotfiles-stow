#!/bin/bash

if (($# == 0)); then
  echo "Usage: launch-or-focus [window-pattern] [launch-command]"
  exit 1
fi

WINDOW_PATTERN="$1"
LAUNCH_COMMAND="${@:2}"
WINDOW_ADDRESS=$(hyprctl clients -j |
  jq --arg p "$WINDOW_PATTERN" '.[]|select((.class|test($p;"i")) or (.title|test($p;"i")))' |
  jq -s 'sort_by(.focusHistoryID)' |
  jq -r '.[]|.address' |
  head -n1)

echo $WINDOW_ADDRESS

if [[ -n $WINDOW_ADDRESS ]]; then
  hyprctl dispatch focuswindow "address:$WINDOW_ADDRESS"
else
  eval exec $LAUNCH_COMMAND
fi
